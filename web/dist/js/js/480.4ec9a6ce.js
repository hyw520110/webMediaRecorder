"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[480],{279:(e,r,o)=>{o.d(r,{KP:()=>a,xY:()=>s});var t=o(953);const a=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});return e.getTracks().forEach((e=>e.stop())),!0}catch(e){return!1}},s=((0,t.KR)(""),(0,t.KR)(null))},480:(e,r,o)=>{o.r(r),o.d(r,{default:()=>b});var t=o(641),a=o(33);const s={id:"video-recorder"},n={class:"recorder-container"},i={class:"video-recorder"},c={ref:"videoPlayer",autoplay:"",muted:""},d={key:0,class:"error-message"};function l(e,r,o,l,u,v){return(0,t.uX)(),(0,t.CE)("div",s,[r[2]||(r[2]=(0,t.Lk)("h2",null,"视频录像机",-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.Lk)("video",c,null,512),(0,t.Lk)("button",{ref:"startVideoBtn",onClick:r[0]||(r[0]=(...e)=>l.startVideoRecording&&l.startVideoRecording(...e))}," 开始录像 ",512),(0,t.Lk)("button",{ref:"stopVideoBtn",disabled:"",onClick:r[1]||(r[1]=(...e)=>l.stopVideoRecording&&l.stopVideoRecording(...e))}," 停止录像 ",512)])]),l.errorMessage?((0,t.uX)(),(0,t.CE)("div",d,(0,a.v_)(l.errorMessage),1)):(0,t.Q3)("",!0)])}var u=o(953),v=o(279);const g=(e,r)=>{try{const o="/websocket",t=new WebSocket(o);return t.onopen=()=>{console.log(`${e} WebSocket 连接已建立`);const o=new Uint8Array(["audio"===e?0:1]);t.send(o),r&&r(t)},t.onerror=r=>{console.error(`${e} WebSocket 错误:`,r)},t.onclose=r=>{console.log(`${e} WebSocket 连接已关闭`,r)},t}catch(o){return console.error(`创建${e} WebSocket失败:`,o),null}},k=()=>{const e=(0,u.KR)(null),r=(0,u.KR)(null),o=(0,u.KR)(null),t=(0,u.KR)(""),a=(0,u.KR)(null),s=(0,u.KR)(null),n=()=>{try{r.value=g("video",(async e=>{const r=await d();if(r){const r=await c();r&&e.send(new Uint8Array([1]))}else e.send(new Uint8Array([1]))}))}catch(e){console.error("启动录像失败:",e),t.value="无法启动录像设备，请检查浏览器权限设置"}},i=()=>{r.value&&r.value.close(),e.value&&e.value.stop(),a.value&&(a.value.disabled=!1),s.value&&(s.value.disabled=!0)},c=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("当前浏览器不支持 getUserMedia");const r=await navigator.mediaDevices.getUserMedia({video:!0});return e.value=new MediaRecorder(r),e.value.ondataavailable=e=>{e.data&&e.data.size},r}catch(r){return console.error("获取视频流失败:",r),t.value="无法访问摄像头，请检查设备权限设置",null}},d=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});return e.getTracks().forEach((e=>e.stop())),!0}catch(e){return!1}},l=()=>{if(v.xY.value&&v.xY.value.srcObject){const e=v.xY.value.srcObject.getTracks();e.forEach((e=>e.stop())),v.xY.value.srcObject=null}};return{mediaRecorder:e,socketRef:r,videoPlayerRef:o,videoErrorMessage:t,startVideoBtn:a,stopVideoBtn:s,startVideoRecording:n,stopVideoRecording:i,getStream:c,checkVideoSupport:d,stopVideoPlayback:l}},p={name:"VideoRecorder",setup(){const{videoPlayer:e,errorMessage:r,startVideoBtn:o,stopVideoBtn:t,startVideoRecording:a,stopVideoRecording:s,checkVideoSupport:n}=k();return{videoPlayer:e,startVideoBtn:o,stopVideoBtn:t,startVideoRecording:a,stopVideoRecording:s,errorMessage:r,checkVideoSupport:n}}};var R=o(262);const V=(0,R.A)(p,[["render",l]]),b=V}}]);
//# sourceMappingURL=480.4ec9a6ce.js.map